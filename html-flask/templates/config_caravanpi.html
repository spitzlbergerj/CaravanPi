<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CaravanPi Caravan Defaults</title>
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/caravanpi.css') }}">
</head>
<body>
	<div class="container">
		<div class="hamburger-menu" onclick="toggleHamburgerMenu()">
			<div></div>
			<div></div>
			<div></div>
		</div>

		<div id="hamburgerMenu" class="hamburger-menu-content">
			<!-- Hamburger-Menü-Links werden per JavaScript hinzugefügt -->
		</div>

		<div class="content">
			<div class="logo">
				<img src="/static/images/CaravanPi-Logo.png" alt="CaravanPi Logo" class="logo">
			</div>
			<hr>

			<h1>CaravanPi Grundeinstellungen</h1>
			<p></p>

		
			{% with messages = get_flashed_messages() %}
				{% if messages %}
					{% for message in messages %}
						<div class="flash-message">{{ message }}</div>
					{% endfor %}
				{% endif %}
			{% endwith %}


			<form class="caravanpi-form" method="post">
				
				<!-- Erläuterung  -->
				<div class="row">
					<div>
						<p>
							Die nachfolgenden Werte werden verwendet, um die Funktionalitäten des CaravanPi auf Ihre Bedürfnisse einzustellen. <br/>
						</p>
					</div>
				</div>
				
				<div class="row">
					<div>
						<p>
						<br/><br/><b>Datenspeicherung</b><br/>
						Die von den unterschiedlichen Sensoren des Caravans ermittelten Werte können in<br/>
						&nbsp;&nbsp;&nbsp;- in Wertedateien (obsolet, nicht mehr empfohlen) gespeichert werden<br/>
						&nbsp;&nbsp;&nbsp;- in einer MariaDB (empfohlen) gespeichert werden<br/>
						&nbsp;&nbsp;&nbsp;- an einen MQTT Broker (in der Cloud) gesandt werden<br/>
					</p>
					</div>
				</div>

				<!-- in Dateien -->
				<div class="row">
					<div class="col-75">
						<label for="write2file">in Wertedateien speichern?</label>  
					</div>
					<div class="col-25">
						<input name="write2file" type="checkbox"  value="1" {{ 'checked' if caravanpiDefaults.get('write2file', False) else '' }}>
					</div>
				</div>

				<p>
					<hr>
				</p>

				<!-- in Datenbank -->
				<div class="row">
					<div class="col-75">
						<label for="write2MariaDB">in der Datenbank speichern?</label>  
					</div>
					<div class="col-25">
						<input name="write2MariaDB" type="checkbox"  value="1" {{ 'checked' if caravanpiDefaults.get('write2MariaDB', False) else '' }}>
					</div>
				</div>

				<p>
				</p>

				<!-- Datenbank Einstellungen -->
				<div class="db-settings">
					<div class="row">
						<div class="col-75">
							<label for="MariaDBhost">IP Adresse des Datenbank Servers (default: localhost)</label>  
						</div>
						<div class="col-25">
							<input name="MariaDBhost" type="char" value="{{ caravanpiDefaults.get('MariaDBhost', '')}}" >
						</div>
					</div>

					<div class="row">
						<div class="col-75">
							<label for="MariaDBuser">Datenbank User</label>  
						</div>
						<div class="col-25">
							<input name="MariaDBuser" type="char" value="{{ caravanpiDefaults.get('MariaDBuser', '')}}" >
						</div>
					</div>

					<div class="row">
						<div class="col-75">
							<label for="MariaDBpasswd">Datenbank Passwort</label>  
						</div>
						<div class="col-25">
							<input name="MariaDBpasswd" type="char" value="{{ caravanpiDefaults.get('MariaDBpasswd', '')}}" >
						</div>
					</div>

					<div class="row">
						<div class="col-75">
							<label for="MariaDBdatabase">Name der Datenbank</label>  
						</div>
						<div class="col-25">
							<input name="MariaDBdatabase" type="char" value="{{ caravanpiDefaults.get('MariaDBdatabase', '')}}" >
						</div>
					</div>
				</div>

				<p>
					<hr>
				</p>

				<!-- an MQTT senden -->
				<div class="row">
					<div class="col-75">
						<label for="send2MQTT">an MQTT Broker senden?</label>  
					</div>
					<div class="col-25">
						<input name="send2MQTT" type="checkbox"  value="1" {{ 'checked' if caravanpiDefaults.get('send2MQTT', False) else '' }}>
					</div>
				</div>

				<p>
				</p>

				<!-- MQTT Einstellungen -->
				<div class="mqtt-settings">
					<div class="row">
						<div class="col-75">
							<label for="MQTTbroker">Adresse des MQTT Brokers</label>  
						</div>
						<div class="col-25">
							<input name="MQTTbroker" type="char" value="{{ caravanpiDefaults.get('MQTTbroker', '')}}" >
						</div>
					</div>

					<div class="row">
						<div class="col-75">
							<label for="MQTTport">Port über den der MQTT Broker angesprochen werden will</label>  
						</div>
						<div class="col-25">
							<input name="MQTTport" type="char" value="{{ caravanpiDefaults.get('MQTTport', '')}}" >
						</div>
					</div>

					<div class="row">
						<div class="col-75">
							<label for="MQTTuser">MQTT User</label>  
						</div>
						<div class="col-25">
							<input name="MQTTuser" type="char" value="{{ caravanpiDefaults.get('MQTTuser', '')}}" >
						</div>
					</div>

					<div class="row">
						<div class="col-75">
							<label for="MQTTpassword">MQTT Passwort</label>  
						</div>
						<div class="col-25">
							<input name="MQTTpassword" type="char" value="{{ caravanpiDefaults.get('MQTTpassword', '')}}" >
						</div>
					</div>
				</div>

				<br/><br/>
				<hr>
				<p><b>Sonstige Einstellungen</b><br/></p>

				<!-- Sonstige Einstellungen -->
				<div class="row">
					<div class="col-75">
						<label for="countGasScales">Anzahl Gasflaschenwaagen</label>  
					</div>
					<div class="col-25">
						<input name="countGasScales" type="number" step="1" min="1" max="2" value="{{ caravanpiDefaults.get('countGasScales', '')}}" >
					</div>
				</div>

				<div class="row">
					<div class="col-75">
						<label for="countTanks">Anzahl Tanks</label>  
					</div>
					<div class="col-25">
						<input name="countTanks" type="number" step="1" min="1" max="3" value="{{ caravanpiDefaults.get('countTanks', '')}}" >
					</div>
				</div>

				<div class="row">
					<div class="col-75">
						<label for="countTanks">Anzahl Klimasensoren</label>  
					</div>
					<div class="col-25">
						<input name="countClimateSensors" type="number" step="1" min="1" max="2" value="{{ caravanpiDefaults.get('countClimateSensors', '')}}" >
					</div>
				</div>


				<!-- Button -->
				<div class="row">
					<div class="button-container">
						<input type="submit" name="submit" value="Speichern" class="finish-button" onclick="hideAndShowMessage()">
						<input type="submit" name="cancel" value="Zurück" class="finish-button">
					</div>
				</div>
			</form>

			<p>&nbsp;</p>
			<p>&nbsp;</p>
			<p>Weitere Infos zum Projekt CaravanPi finden Sie auf der <a href="https://www.caravanpi.de">CaravanPi-Website</a> und auf <a href="https://github.com/spitzlbergerj/CaravanPi">github</a></p>
		</div>

		<div class="footer">
			<p>&copy; CaravanPi - Josef Spitzlberger - 2024</p>
		</div>
	</div>

	<!-- Einbindung des zentralen JavaScript-Scripts am Ende der Seite -->
	<script src="{{ url_for('static', filename='js/build_menus.js') }}"></script>

	<!-- Steuerung der Sichtbarkeit der Felder für MariaDB und MQTT -->
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			// Funktion zum Ein-/Ausblenden der Einstellungen
			function toggleSettings(checkbox, settingsClass, shouldClearValues = false) {
				var settings = document.querySelector(settingsClass);
				if (checkbox.checked) {
					settings.style.display = 'block';
				} else {
					settings.style.display = 'none';
					if (shouldClearValues) {
						settings.querySelectorAll('input').forEach(function(input) {
							input.value = ''; // Setzt den Wert jedes Eingabefeldes zurück
						});
					}
				}
			}
		
			var write2DBCheckbox = document.querySelector('input[name="write2MariaDB"]');
			var send2MQTTCheckbox = document.querySelector('input[name="send2MQTT"]');
		
			// Initialer Aufruf für den Fall, dass die Checkboxen bereits markiert sind
			toggleSettings(write2DBCheckbox, '.db-settings', true);
			toggleSettings(send2MQTTCheckbox, '.mqtt-settings', true);
		
			// Event Listener für Änderungen
			write2DBCheckbox.addEventListener('change', function() {
				toggleSettings(this, '.db-settings', true);
			});
		
			send2MQTTCheckbox.addEventListener('change', function() {
				toggleSettings(this, '.mqtt-settings', true);
			});
		});
	</script>
		
</body>
</html>

